
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Generate a new project</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="alm-new-project"
                  title="Generate a new project"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introduction" duration="0">
        <h2 is-upgraded>What you will build</h2>
<p>In this tutorial, you will generate a set of files for a new project based on a standardised template that will:</p>
<ul>
<li>To create a source repository to store your development changes</li>
<li>Create pipelines which builds, validates and deploys code to specified environments</li>
<li>Can also generate additional files during the project lifecycle as the solution grows</li>
<li>Create unmanaged solutions in Master environment</li>
<li>Using the ADO generator to create the pipelines etc - inputs and outputs</li>
<li>Setup branch policies and repo permissions</li>
</ul>
<p>To achieve this, you&#39;ll use our tool, <a href="https://github.com/Capgemini/powerapps-project-template" target="_blank">Project Generator</a>.</p>
<h2 is-upgraded>Prerequisites</h2>
<ul>
<li><a href="https://nodejs.org/" target="_blank">NPM and Node JS</a></li>
<li><a href="https://code.visualstudio.com" target="_blank">VS Code</a></li>
<li><a href="https://gitforwindows.org/" target="_blank">Git</a></li>
<li>An Azure DevOps project</li>
<li>A Power Apps Development Environment</li>
<li>A Power Apps CI Environment</li>
<li>A Power Apps Test Environment</li>
</ul>
<p>Positive : For setting up the Power Apps environments, follow <a href="../alm-environment-setup" target="_blank">this</a> lab.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Install the generator" duration="0">
        <p>Before you can generate a new project, you need to install the generator globally on to your local machine.</p>
<p>Firstly, open up a Command Prompt or PowerShell.</p>
<p>Next, install <a href="https://www.npmjs.com/package/yo" target="_blank">yo</a>, the generator engine, and <a href="https://www.npmjs.org/package/@capgeminiuk/generator-powerapps-project" target="_blank">@capgeminiuk/generator-powerapps-project</a>, our project generator.</p>
<pre><code language="language-shell" class="language-shell">npm install --global yo @capgeminiuk/generator-powerapps-project
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Generate base project" duration="0">
        <p>Stay in command prompt or PowerShell and navigate to the folder you want the generate the project within. For example:</p>
<pre><code language="language-shell" class="language-shell">cd C:/code
mkdir my-project
cd my-project
</code></pre>
<p>Next, run the base generator to build the file structure for our project by running.</p>
<pre><code>yo @capgeminiuk/powerapps-project
</code></pre>
<p>It may take a few seconds for you to be prompted, but eventually you will be prompted for several inputs:</p>
<table>
<tr><td colspan="1" rowspan="1"><p>Input</p>
</td><td colspan="1" rowspan="1"><p>Purpose</p>
</td><td colspan="1" rowspan="1"><p>Example</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the client?</p>
</td><td colspan="1" rowspan="1"><p>Used within naming files and folders produced by the generator</p>
</td><td colspan="1" rowspan="1"><p>MACE</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the package?</p>
</td><td colspan="1" rowspan="1"><p>Used creating files, folders and PowerApps solutions</p>
</td><td colspan="1" rowspan="1"><p>ALMLAB</p>
</td></tr>
</table>
<p>Open the generated project in either VS Code or the file explorer and take this opportunity to browse through the files seeing what was created and how the values you&#39;ve entered have been passed into the naming of files and folders.</p>
<p>To open your project in VS Code from command prompt run <code>code .</code></p>
<p class="image-container"><img alt="image.png" src="img/c4cce2099d17f700.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Generate solution" duration="0">
        <p>Now we are going to generate our solution structure by running:</p>
<pre><code language="language-shell" class="language-shell">yo @capgeminiuk/powerapps-project:solution
</code></pre>
<p>You will again be prompted for several inputs:</p>
<table>
<tr><td colspan="1" rowspan="1"><p>Input</p>
</td><td colspan="1" rowspan="1"><p>Purpose</p>
</td><td colspan="1" rowspan="1"><p>Example</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Publisher prefix?</p>
</td><td colspan="1" rowspan="1"><p>Used to prefix components in PowerApps and is mapped to the solution prefix</p>
</td><td colspan="1" rowspan="1"><p>MACE</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the client?</p>
</td><td colspan="1" rowspan="1"><p>Used within naming files and folders produced by the generator, entered in the above <strong>Generate solution</strong> step. The command prompt will recognise your previously entered value and suggest the value which you can accept as a default by pressing enter</p>
</td><td colspan="1" rowspan="1"><p>MACE</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the package?</p>
</td><td colspan="1" rowspan="1"><p>Used creating files, folders and PowerApps solutions, entered in the above <strong>Generate solution</strong> step. The command prompt will recognise your previously entered value and suggest the value which you can accept as a default by pressing enter</p>
</td><td colspan="1" rowspan="1"><p>ALMLAB</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the solution?</p>
</td><td colspan="1" rowspan="1"><p>Used to create the name of your solution in PowerApps</p>
</td><td colspan="1" rowspan="1"><p>Sample</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Development environment URL?</p>
</td><td colspan="1" rowspan="1"><p>Stored within the repository to be used for local extractions of solutions and config e.g. code generation. <strong>Be sure to prefix URL with https://</strong></p>
</td><td colspan="1" rowspan="1"><p><em>Paste the Development environment URL from notepad which we copied earlier in the lab</em></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Are changes to this promoted using a staging environment?</p>
</td><td colspan="1" rowspan="1"><p>Used to determine whether solution extracts should be done in Development or another extract.</p>
</td><td colspan="1" rowspan="1"><p>Y if using Development Hub, overwise N</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Staging environment URL?</p>
</td><td colspan="1" rowspan="1"><p>Only asked if you answered Y above. Used for extracting the solution locally or in the generated pipeline <strong>Be sure to prefix URL with https://</strong></p>
</td><td colspan="1" rowspan="1"><p><em>Paste the Master environment URL from notepad which we copied earlier in the lab</em></p>
</td></tr>
</table>
<p>You will then be prompted to overwrite the following files:</p>
<ul>
<li><code>.vscode\tasks.json</code></li>
<li><code>deploy\PkgFolder\ImportConfig.xml</code></li>
</ul>
<p>Enter <code>y</code> and press <strong>Enter</strong></p>


      </google-codelab-step>
    
      <google-codelab-step label="Create unmanaged solution in Master environment" duration="0">
        <p>Open the <a href="https://make.powerapps.com" target="_blank">Maker portal</a> and switch environments to the Master</p>
<p>Navigate to <strong>Solutions</strong> in the left-hand pane and select <strong>+ New solution</strong></p>
<p>Enter the following details:</p>
<table>
<tr><td colspan="1" rowspan="1"><p>Field</p>
</td><td colspan="1" rowspan="1"><p>Value</p>
</td><td colspan="1" rowspan="1"><p>Example</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Display name</p>
</td><td colspan="1" rowspan="1"><p>This should be the name of the package followed by the name of the solution.</p>
</td><td colspan="1" rowspan="1"><p>ALMLAB Sample</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name</p>
</td><td colspan="1" rowspan="1"><p>This should be the name of the created solution folder</p>
</td><td colspan="1" rowspan="1"><p>MSACE_ALMLAB_Sample</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Publisher</p>
</td><td colspan="2" rowspan="1"><p>Please create this yourself with the prefix given for the question ‘Publisher prefix?&#39;</p>
</td><td colspan="1" rowspan="1"></td></tr>
<tr><td colspan="1" rowspan="1"><p>Version</p>
</td><td colspan="1" rowspan="1"><p>The initial solution version.</p>
</td><td colspan="1" rowspan="1"><p>1.0.0</p>
</td></tr>
</table>
<p>Select <strong>Create</strong></p>


      </google-codelab-step>
    
      <google-codelab-step label="Run automated Azure DevOps setup" duration="0">
        <p>First, you need to create a Personal Access Token (PAT) so that the generator can talk to Azure DevOps on behalf of your account.</p>
<p>Open Azure DevOps, select <strong>User settings</strong> (user icon with a little cog) and select <strong>Personal access tokens</strong></p>
<p class="image-container"><img alt="image.png" src="img/b4b6788ac82b63de.png"></p>
<p>Select <strong>+ New Token</strong> then enter the following values:</p>
<p class="image-container"><img alt="image.png" src="img/a1789bab018edca1.png"></p>
<table>
<tr><td colspan="1" rowspan="1"><p>Field</p>
</td><td colspan="1" rowspan="1"><p>Value</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name</p>
</td><td colspan="1" rowspan="1"><p>Generator</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Organisation</p>
</td><td colspan="1" rowspan="1"><p>Ensure your current Azure DevOps organisation is selected</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Expiration (UTC)</p>
</td><td colspan="1" rowspan="1"><p>select an expiry date of tomorrow</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Scopes</p>
</td><td colspan="1" rowspan="1"><p>Full access</p>
</td></tr>
</table>
<p class="image-container"><img alt="image.png" src="img/5635f583f27849a.png"></p>
<p>Positive : <strong>Important:</strong> Copy the token to notepad as you&#39;ll need this later.</p>
<p>Negative : If Package Name and Azure DevOps Project name are the same then the generator will fail. In this case, rename the pre-created repo in Azure Devops by:</p>
<ol type="1">
<li>Go to the Project Settings</li>
<li>Under Repos, select Repositories</li>
<li>For the repo with the same name, use the three dots to rename the repo to ‘[existing name]_old&#39;</li>
</ol>
<p>Now you are going to set up Azure DevOps by running <code>yo @capgeminiuk/powerapps-project:azuredevops</code>. You&#39;ll be prompted for the following inputs, after entering the value for each one, press <strong>Enter</strong>:</p>
<table>
<tr><td colspan="1" rowspan="1"><p>Input</p>
</td><td colspan="1" rowspan="1"><p>Purpose</p>
</td><td colspan="1" rowspan="1"><p>Example</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Azure DevOps URL?</p>
</td><td colspan="1" rowspan="1"><p>The URL of the Azure DevOps Organisation</p>
</td><td colspan="1" rowspan="1"><p>https://dev.azure.com/cap-alm-lab</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Azure DevOps Auth Token (managed)?</p>
</td><td colspan="1" rowspan="1"><p>Paste in the PAC generated before</p>
</td><td colspan="1" rowspan="1"><p>***</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Azure DevOps project?</p>
</td><td colspan="1" rowspan="1"><p>Select your project from the dropdown options by using the down arrows</p>
</td><td colspan="1" rowspan="1"><p>ALMLab</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the client?</p>
</td><td colspan="1" rowspan="1"><p>Used within naming files and folders produced by the generator</p>
</td><td colspan="1" rowspan="1"><p>MACE</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name of the package?</p>
</td><td colspan="1" rowspan="1"><p>Used creating files, folders and PowerApps solutions, entered in the above <strong>Generate solution</strong> step. The command prompt will recognise your previously entered value and suggest the value which you can accept as a default by pressing enter</p>
</td><td colspan="1" rowspan="1"><p>ALMLAB</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>CI Environment URL?</p>
</td><td colspan="1" rowspan="1"><p>The URL of the CI environment used for the solution checker and deploying to CI environment</p>
</td><td colspan="1" rowspan="1"><p>https://[???].crm11.dynamics.com</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Service Account Email?</p>
</td><td colspan="1" rowspan="1"><p>The email address to use for the UI automation tests and running the extract pipeline. This user needs access to the 3 Power Platform Environments</p>
</td><td colspan="1" rowspan="1"><p>If you don&#39;t have a service account, you can use your own for now and update these details later.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Service Account Password?</p>
</td><td colspan="2" rowspan="1"><p>Used in conjunction with the Service Account Username.</p>
</td><td colspan="1" rowspan="1"></td></tr>
<tr><td colspan="1" rowspan="1"><p>Tenant ID?</p>
</td><td colspan="1" rowspan="1"><p>Used for creating the Service Connection in Azure DevOps which is used for the solution checker and deploying to CI environment</p>
</td><td colspan="1" rowspan="1"><p><em>Paste value from notepad which copied earlier in the lab</em></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Application ID?</p>
</td><td colspan="1" rowspan="1"><p>Used in conjunction with Tenant ID</p>
</td><td colspan="1" rowspan="1"><p><em>Paste value from notepad which copied earlier in the lab</em></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Client Secret?</p>
</td><td colspan="1" rowspan="1"><p>Used in conjunction with Tenant ID</p>
</td><td colspan="1" rowspan="1"><p><em>Paste value from notepad which copied earlier in the lab</em></p>
</td></tr>
</table>
<p>If the generation was successful, the output should look like this:</p>
<pre><code>Setting up Azure DevOps...
Generating variable groups...
Creating Package - ALMLAB variable group...
Creating Integration Tests - ALMLAB variable group...
Creating Cake - ALMLAB variable group...
Generating repository...
Creating almlab repository...
Pushing initial commit to https://cap-alm-lab@dev.azure.com/cap-alm-lab/ALMLab/_git/almlab
Generating builds definitions...
Found 2 YAML builds.
Creating pipelines/azure-pipelines-dynamics-365-extract.yml build...
Creating pipelines/azure-pipelines.yml build...
Extension: PowerPlatform-BuildTools is already installed.
Extension: sarif-viewer-build-tab is already installed.
Generating service connections...
Generating release definition...
Creating ALMLAB release...
Finished setting up Azure DevOps.
Done.
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Set up Branch Policies" duration="0">
        <p>Within Azure DevOps navigate to <strong>Project Settings</strong> then under <strong>Repos</strong>, select <strong>Repositories</strong>.</p>
<p class="image-container"><img alt="image.png" src="img/9bb53c183d251010.png"></p>
<p>Now select your repository called the package name you gave and select the <strong>Policies</strong> tab. Under <strong>Branch Policy</strong> select <strong>master</strong>.</p>
<p class="image-container"><img alt="image.png" src="img/b3c18de0d9ca36d.png"></p>
<p>Turn on:</p>
<ul>
<li><strong>Require a minimum number of reviewers<br></strong> Configure the settings as described below:<table>
<tr><td colspan="1" rowspan="1"><p>Field</p>
</td><td colspan="1" rowspan="1"><p>Value</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Minimum number of reviewers</p>
</td><td colspan="1" rowspan="1"><p>2</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Allow requestors to approve their own changes</p>
</td><td colspan="1" rowspan="1"><p>Unchecked</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Prohibit the most recent pusher from approving their own changes</p>
</td><td colspan="1" rowspan="1"><p>Unchecked</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Allow completion even if some reviewers vote to wait or reject</p>
</td><td colspan="1" rowspan="1"><p>Unchecked</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>When new changes are pushed:</p>
</td><td colspan="1" rowspan="1"><p>Reset all code reviewer votes</p>
</td></tr>
</table>
</li>
<li><strong>Check for linked work items</strong> ensuring <strong>Required</strong> is selected.</li>
<li>Turn on <strong>Check for comment resolutions</strong> ensuring <strong>Required</strong> is selected.</li>
<li>Turn on <strong>Limit merge types</strong> ensuring only <strong>Squash merge</strong> is checked.</li>
</ul>
<p class="image-container"><img alt="image.png" src="img/c108cd8fdbb71750.png"></p>
<p>Select the <strong>+</strong> (Add new build policy) button associated with <strong>Build Validation</strong></p>
<p class="image-container"><img alt="Add new build policy" src="img/86dd67e8a24003b0.png"></p>
<p>Input the following values:</p>
<table>
<tr><td colspan="1" rowspan="1"><p>Field</p>
</td><td colspan="1" rowspan="1"><p>Value</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Build pipeline</p>
</td><td colspan="1" rowspan="1"><p> - Package Build (PackageName)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Path filter (optional)</p>
</td><td colspan="1" rowspan="1"><p>N/A</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Trigger</p>
</td><td colspan="1" rowspan="1"><p>Automatic (whenever the source branch is updated)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Policy requirement</p>
</td><td colspan="1" rowspan="1"><p>Required</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Build expiration</p>
</td><td colspan="1" rowspan="1"><p>Immediately when master is updated</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Display name</p>
</td><td colspan="1" rowspan="1"><p>N/A</p>
</td></tr>
</table>
<p>Select <strong>Save</strong></p>
<p class="image-container"><img alt="image.png" src="img/2062dfd55cee8e3.png"></p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
