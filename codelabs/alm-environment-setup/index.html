
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Environment Setup</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="alm-environment-setup"
                  title="Environment Setup"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introduction" duration="0">
        <h2 is-upgraded>What you&#39;ll build &amp; learn</h2>
<p>This lab gives you a hands-on walkthrough to setup several Power Platform environments for use with development hub. You will:</p>
<ul>
<li>use the power platform admin centre to create 3 environments (development, extract and continuous integration)</li>
<li>use Azure Active Directory to create an application user</li>
<li>register the new user across the 3 power platform environments with System Administrator rights</li>
</ul>
<h2 is-upgraded>Prerequisites</h2>
<ul>
<li>Dynamics 365 admin, Global admin, or Power Platform admin to a PowerApps tenant <ul>
<li>Dynamics 365 Admin or Power Platform Admin to create instances</li>
<li>Global Admin is only required if you want to configure Exchange integration and approve email accounts</li>
</ul>
</li>
<li>Azure DevOps organisation created with a project created</li>
<li>Preferably you will <strong>request your account have Project collection administrator access</strong> in Azure DevOps but as most Azure DevOps instances are hosted by clients they are sometimes reluctant to grant you this permission. This permission is required to enable you to install the required third-party extensions to Azure DevOps that are consumed by our tooling. If you struggle getting these permissions <strong>at a minimum you will need Project administrator access</strong> for an Azure DevOps project so you can request the extensions to be installed by a Project collection administrator.</li>
</ul>
<p>Project collection administrator access is required to install the following tools without approval, if not possible then Project administrator will allow you to request these tools be installed to an Azure DevOps organisation:</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=microsoft-IsvExpTools.PowerPlatform-BuildTools" target="_blank">Power Platform Build Tools</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=sariftools.sarif-viewer-build-tab" target="_blank">Sarif Viewer Build Tab</a></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Request additional tools for Azure DevOps" duration="0">
        <p><strong>Important:</strong> Only required if you only have Project administrator access to Azure DevOps</p>
<p>Open <a href="https://marketplace.visualstudio.com/items?itemName=microsoft-IsvExpTools.PowerPlatform-BuildTools" target="_blank">Power Platform Build Tools</a></p>
<p>Select <strong>Get it free</strong></p>
<p class="image-container"><img alt="image.png" src="img/22c8d34d23cba23f.png"></p>
<p>You&#39;ll then be prompted to <strong>Select an Azure DevOps organization</strong>. Select your Azure DevOps organisation and select <strong>Request</strong></p>
<p class="image-container"><img alt="image.png" src="img/7f482178a8c10492.png"></p>
<p>Repeat this step for <a href="https://marketplace.visualstudio.com/items?itemName=sariftools.sarif-viewer-build-tab" target="_blank">Sarif Viewer Build Tab</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Create environments" duration="0">
        <p>Open up the <a href="https://admin.powerplatform.microsoft.com/" target="_blank">‘Power Platform admin center&#39;</a> as an admin (Dynamics 365 admin, Global admin, or Power Platform admin).</p>
<p>If not automatically re-directed, navigate to <strong>Environments</strong> in the left-hand pane</p>
<p>Click <strong>New</strong></p>
<p><img alt="new-environment.png" src="img/b278f24c555cc66a.png"> You will then be prompted to enter the following details:</p>
<table>
<tr><td colspan="1" rowspan="1"><p>             Field         </p>
</td><td colspan="1" rowspan="1"><p>             Value         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"></td></tr>
<tr><td colspan="1" rowspan="1"><p>             Name         </p>
</td><td colspan="1" rowspan="1"><p>             {Project name}Development e.g. ALMDevelopment         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Type         </p>
</td><td colspan="1" rowspan="1"><p>             Sandbox         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Region         </p>
</td><td colspan="1" rowspan="1"><p>             United Kingdom - Default         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Purpose         </p>
</td><td colspan="1" rowspan="1"><p>             Include project name and reason for creating the environment e.g. ALM for MACE         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Create a database for this environment         </p>
</td><td colspan="1" rowspan="1"><p>             Yes         </p>
</td></tr>
</table>
<p>Select <strong>Next</strong> to move onto next set of fields <img alt="new-environment-page1.png" src="img/cdc5c5bcf3fc3ad8.png"></p>
<table>
<tr><td colspan="1" rowspan="1"><p>             Field         </p>
</td><td colspan="1" rowspan="1"><p>             Value         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Language         </p>
</td><td colspan="1" rowspan="1"><p>             English         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             URL         </p>
</td><td colspan="1" rowspan="1"><p>             [Project name][environment name] e.g. MACEALMDevelopment         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Currency         </p>
</td><td colspan="1" rowspan="1"><p>             GBP (£)         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Enable Dynamics 365 Apps         </p>
</td><td colspan="1" rowspan="1"><p>             Project dependent but for lab leave as **No**         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Deploy sample apps and data         </p>
</td><td colspan="1" rowspan="1"><p>             No         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Security group         </p>
</td><td colspan="1" rowspan="1"><p>             Not applicable         </p>
</td></tr>
</table>
<p class="image-container"><img alt="new-environment-page2-enable-apps.png" src="img/38b1702e7af4c361.png"></p>
<p>Select <strong>Save</strong> Repeat steps above for the below two environments swapping out the details as necessary:</p>
<p><strong>Master</strong></p>
<table>
<tr><td colspan="1" rowspan="1"><p>             Field         </p>
</td><td colspan="1" rowspan="1"><p>             Value         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Name         </p>
</td><td colspan="1" rowspan="1"><p>             [Project name]Master e.g. ALMMaster         </p>
</td></tr>
</table>
<p><strong>CI</strong></p>
<table>
<tr><td colspan="1" rowspan="1"><p>             Field         </p>
</td><td colspan="1" rowspan="1"><p>             Value         </p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>             Name         </p>
</td><td colspan="1" rowspan="1"><p>             [Project name]CI e.g. ALMCI         </p>
</td></tr>
</table>
<p><strong>Important:</strong> note down the <strong>URLs of all environments</strong> created into a text tool such as notepad as these will be used later on in the lab.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Register a new Azure application" duration="0">
        <h2 is-upgraded>Why?</h2>
<p>The application in Azure Active Directory gives our development tooling, primarily Azure DevOps and Development Hub, the ability to talk to Dynamics 365. It enables:</p>
<ul>
<li>Development Hub to extract and import solutions across environments</li>
<li>Allows to call Microsoft&#39;s Solution checker for the Power Platform in an Azure DevOps build to verify the quality of a solution</li>
</ul>
<h2 is-upgraded>Setup</h2>
<p>Navigate to <a href="https://aad.portal.azure.com/" target="_blank">Azure Active Directory</a></p>
<p>From the left panel, choose <strong>Azure Active Directory</strong> &gt; <strong>App registrations</strong></p>
<p>Choose <strong>+ New registration</strong></p>
<p class="image-container"><img alt="image.png" src="img/91b9c9dde1667455.png"></p>
<p>In the <strong>Register an application form</strong> provide a name for your app such as <strong>DevOps User</strong>, select <strong>Accounts in this organizational directory only</strong>, and choose <strong>Register</strong>. A redirect URI is not needed for this walkthrough and the provided sample code.</p>
<p class="image-container"><img alt="s2s-app-registration-started.png" src="img/a4209a8dd3596658.png"></p>
<p>On the <strong>Overview</strong> page, select <strong>API permissions</strong></p>
<p>Choose <strong>+ Add a permission</strong><img alt="image.png" src="img/485cd41ed1658574.png"></p>
<p>In the <strong>Microsoft APIs</strong> tab, <strong>choose Dynamics CRM</strong></p>
<p>In the <strong>Request API permission</strong> form, select <strong>Delegated permissions</strong>, check <strong>user_impersonation</strong>, and select <strong>Add permissions</strong></p>
<p class="image-container"><img alt="s2s-api-permission-started.png" src="img/30c2310169b1b4b9.png"></p>
<p>On the <strong>API permissions</strong> page select <strong>Grant admin consent for &#34;org-name&#34;</strong> and when prompted choose <strong>Yes</strong></p>
<p class="image-container"><img alt="s2s-api-permission-completed.png" src="img/f388c7d919129027.png"></p>
<p>Important: Select <strong>Overview</strong> in the navigation panel, record the <strong>Display name</strong>, <strong>Application (client) ID</strong>, and <strong>Directory (tenant) ID</strong> values of the app registration. You will use these later in the lab.</p>
<p class="image-container"><img alt="image.png" src="img/ebe2acd861b79888.png"></p>
<p>In the navigation panel, select <strong>Certificates &amp; secrets</strong></p>
<p>Below <strong>Client secrets</strong>, choose <strong>+ New client secret</strong> to create a secret</p>
<p>In the form, enter a description and select <strong>Add</strong>.</p>
<p><strong>Important:</strong> Record the secret string. You will not be able to view the secret again once you leave the current screen.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Application user creation" duration="0">
        <p>Open the <a href="https://make.powerapps.com/" target="_blank"><strong>Maker Portal</strong></a>.</p>
<p>Select the current environment (in the screenshot this is ‘CSD - PP - Development&#39;) in the banner on the top right-hand side of the page and choose your Dataverse environment</p>
<p class="image-container"><img alt="image.png" src="img/849fba14dcc457b3.png"></p>
<p>Once you&#39;re in the right environment, choose the <strong>cog icon for Settings</strong> and select <strong>Advanced settings</strong></p>
<p class="image-container"><img alt="image.png" src="img/cc9592c58ae31bc1.png"></p>
<p>Navigate to <strong>Settings</strong> &gt; <strong>Security</strong> &gt; <strong>Users</strong>.</p>
<p>Change the view filter to <strong>Application Users</strong> by selecting <strong>Enabled Users</strong> and choosing <strong>Application Users</strong></p>
<p class="image-container"><img alt="image.png" src="img/85e9a612de950aaa.png"></p>
<p>Select <strong>+ New</strong>.</p>
<p class="image-container"><img alt="image.png" src="img/6cd23da5abc87f5a.png"></p>
<p>Change the Dynamics form by selecting <strong>User</strong> and choosing <strong>Application User</strong><img alt="image.png" src="img/a7eb6a4046c7857f.png"></p>
<p>In the <strong>Application ID</strong> field, enter the <strong>Application ID (Client ID)</strong> of the app you registered earlier in Azure Active Directory which you also copied to a notepad and select <strong>SAVE</strong><img alt="s2s-new-appuser1.png" src="img/8780869039c13047.png"></p>
<p>After selecting <strong>SAVE</strong>, if all goes well, the <strong>User Name</strong>, <strong>Application ID URI</strong>, <strong>Azure AD Object Id</strong>, <strong>Full Name</strong>, and <strong>Primary Email</strong> fields will auto-populate with correct values</p>
<p class="image-container"><img alt="image.png" src="img/48f0c04390d6fca1.png"></p>
<p>Before exiting the user form, choose <strong>MANAGE ROLES</strong> and assign the System Administrator security role.</p>
<p class="image-container"><img alt="image.png" src="img/e6b32593e29b97bf.png"></p>
<p>Click <strong>OK</strong></p>
<p>Repeat this (Application user creation) step for the other two Power Platform environments you created earlier on:</p>
<ul>
<li>[Project name]Master</li>
<li>[Project name]CI</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
